function _createForOfIteratorHelperLoose(e,t){var i,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return(s=s.call(e)).next.bind(s);if(Array.isArray(e)||(s=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),i=0,function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(i="Object"===i&&e.constructor?e.constructor.name:i)||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}var FPF_SearchDropdown=function(){function e(){var i;this.wrapperElement=".fpf-searchdropdown-wrapper",this.loadingIconClass=".fpf-searchdropdown-spinner",this.dropdownToggle=".fpf-searchdropdown-popup-toggle",this.resultsElement=".fpf-searchdropdown-search-results",this.resultsOnClickElement=".fpf-searchdropdown-search-results-on-click",this.choicesElement=".fpf-searchdropdown-search-choices",this.searchItemClass="fpf-searchdropdown-search-input",this.resultRemoveItem=".fpf-searchdropdown-search-results-remove-item",this.removeSingleValueButton=".fpf-searchdropdown-remove-single-value-button",this.loadingAjax=[],this.navigation_selected_item,this.navigation_index=1,this.previous_search_query="",this.delay=(i=0,function(e,t){clearTimeout(i),i=setTimeout(e,t)}),this.init()}var t=e.prototype;return t.init=function(){this.initEvents()},t.initEvents=function(){document.addEventListener("click",function(e){this.handleOnClickResultsToggle(e),this.handleResetActiveInstances(e),this.handleResultsClick(e),this.handleResultItemRemoval(e),this.handleRemoveSingleValue(e),this.handleDropdownToggle(e)}.bind(this)),document.addEventListener("scroll",function(e){this.onScrollResults(e)}.bind(this),!0),document.addEventListener("keyup",function(e){this.handleItemSearch(e)}.bind(this)),document.addEventListener("keydown",function(e){this.handleResultsKeyboardNavigation(e),this.handleResultsEnterPress(e),this.handleEscapeClosing(e)}.bind(this))},t.onScrollResults=function(t){var e,i,s,n,l,r,a,o,c;!t.target.closest(this.wrapperElement)||(e=this.getWrapper(t.target))&&!e.getAttribute("data-local-search")&&(c=e.querySelector(".nonce_hidden").value,i=this,s=e.querySelector('li.hidden-template input[type="hidden"]').dataset.name,97<100*t.target.scrollTop/(t.target.scrollHeight-t.target.clientHeight)&&!this.loadingAjax[s]&&(this.loadingAjax[s]=!0,n=e.querySelectorAll(this.resultsElement+".lazyload ul li").length,l=e.getAttribute("data-hide-ids"),r=e.getAttribute("data-hide-flags"),(a=e.querySelector("."+this.searchItemClass).getAttribute("data-path"))&&(o={nonce:c,path:a,offset:n,ids:i.getAssignedIDs(e.querySelector("."+this.searchItemClass)),hide_ids:l,hide_flags:r,action:"fpf_searchdropdown_lazyload_results"},i.showLoadingIcon(e),c=Object.keys(o).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(o[e])}).join("&"),fetch(fpf_js_object.ajax_url+"?"+c).then(function(e){return e.json()}).then(function(e){void 0!==e.html&&""!=e.html&&t.target.querySelector("ul").insertAdjacentHTML("beforeend",e.html),i.loadingAjax[s]=!1}).finally(function(){i.hideLoadingIcon(e)}))))},t.handleResultsKeyboardNavigation=function(e){var t,i,s=this.getWrapper(e.target);!s||40!=e.which&&38!=e.which||(s=s.querySelector(this.resultsElement+".is-visible ul"))&&(t=s.querySelectorAll("li:not(.is-hidden)").length-1,40==e.which?(this.navigation_index++,this.navigation_selected_item?(this.navigation_selected_item.classList.remove("selected"),i=this.findNextNavigationItem(s,this.navigation_index,"down"),this.navigation_index=i.index,i=i.li,this.navigation_index<=t?this.navigation_selected_item=i:(this.navigation_index=0,this.navigation_selected_item=s.getElementsByTagName("li")[0])):(i=this.findNextNavigationItem(s,0,"down"),this.navigation_index=i.index,this.navigation_selected_item=i.li),this.navigation_selected_item&&this.navigation_selected_item.classList.add("selected")):38==e.which&&(this.navigation_selected_item?(this.navigation_selected_item.classList.remove("selected"),i=this.findNextNavigationItem(s,this.navigation_index,"up"),this.navigation_index=i.index,e=i.li,0<=this.navigation_index?this.navigation_selected_item=e:(this.navigation_index=t,this.navigation_selected_item=s.getElementsByTagName("li")[t])):(i=this.findNextNavigationItem(s,0,"up"),this.navigation_index=i.index,this.navigation_selected_item=i.li),this.navigation_selected_item&&this.navigation_selected_item.classList.add("selected")),this.navigation_selected_item&&(e=this.navigation_selected_item.offsetHeight,s.parentElement.scrollTop=e*this.navigation_index-2*e))},t.findNextNavigationItem=function(e,t,i){var s=e.querySelectorAll("li:not(.is-hidden)");if("down"==i){if(t>=s.length)return this.findNextNavigationItem(e,0,"down");for(var n=0,l=_createForOfIteratorHelperLoose(s);!(r=l()).done;){var r=r.value;if(r.classList.contains("is-disabled")||r.classList.contains("skip")||r.classList.contains("is-hidden"))n++;else{if(n>s.length-1)return this.findNextNavigationItem(e,0,"down");if(!(n<t))return{li:r,index:n};n++}}return this.allListItemsAraUnavailable(s)?{li:null,index:0}:this.findNextNavigationItem(e,0,"down")}if(t<=0)return this.findNextNavigationItem(e,s.length+1,"up");for(var a=s.length-1;0<=a;a--){var o=s[a];if(!(o.classList.contains("is-disabled")||o.classList.contains("skip")||o.classList.contains("is-hidden"))){if(a<0)return this.findNextNavigationItem(e,s.length+1,"up");o={li:o,index:a};if(!(t<=a))return o}}return this.allListItemsAraUnavailable(s)?{li:null,index:0}:this.findNextNavigationItem(e,s.length+1,"up")},t.allListItemsAraUnavailable=function(e){if(!e)return!0;for(var t=_createForOfIteratorHelperLoose(e);!(i=t()).done;){var i=i.value;if(!i.classList.contains("is-disabled")&&!i.classList.contains("skip"))return!1}return!0},t.handleResultsEnterPress=function(e){var t;13==e.which&&(t=this.getWrapper(e.target))&&(t=t.querySelector(this.resultsElement+".is-visible li.selected"))&&(this.onResultClick(t),document.activeElement.blur(),e.preventDefault())},t.handleEscapeClosing=function(e){27==(e=e||window.event).keyCode&&this.getWrapper(e.target)&&this.hideOtherInstances(e)},t.handleDropdownToggle=function(e){var t=e.target.closest(this.dropdownToggle);t&&!e.target.closest(this.removeSingleValueButton)&&(this.hideOtherInstances(e),e=t.classList.contains("is-active")?"close":"open",this.dropdownChangeStatus(t,e))},t.dropdownChangeStatus=function(e,t){var i;"open"==t?(e.classList.add("is-active"),e.parentElement.classList.add("is-active"),e.parentElement.querySelector(this.resultsOnClickElement).classList.add("is-visible"),this.resetNavigationElements(e),i=e.nextElementSibling.querySelector("."+this.searchItemClass),setTimeout(function(){i.focus()},50)):(e.classList.remove("is-active"),e.parentElement.classList.remove("is-active"),(t=e.parentElement.querySelector(this.resultsOnClickElement))&&t.querySelectorAll("li.is-hidden").forEach(function(e){e.classList.remove("is-hidden")}))},t.resetNavigationElements=function(e){e=this.getWrapper(e),this.navigation_index=0,this.navigation_selected_item=null,e=e.querySelectorAll("li.selected");e&&e.forEach(function(e){e.classList.remove("selected")})},t.handleDropdownClose=function(e){var t=this,i=document.querySelectorAll(this.dropdownToggle+".is-active");i&&i.forEach(function(e){t.dropdownChangeStatus(e,"close")})},t.handleResetActiveInstances=function(e){e.target.closest(this.resultsElement)||e.target.closest(this.choicesElement)||this.hideOtherInstances(e)},t.hideOtherInstances=function(e){var t,i=this;e.target.closest(".fpf-modal.upgrade-pro")||((t=document.querySelectorAll(this.wrapperElement+".clicked"))&&t.forEach(function(e){"0"!=e.getAttribute("data-multiple")&&e.classList.remove("clicked")}),(t=document.querySelectorAll(this.resultsElement+".is-visible"))&&t.forEach(function(e){i.clearItem(e)}),this.handleDropdownClose(e))},t.clearItem=function(e){var t=e.querySelector(this.choicesElement+' input[type="text"]');t&&(t.value=""),this.clearResultsBox(e)},t.handleItemSearch=function(e){var t,i=e.target;i.classList.contains(this.searchItemClass)&&(t=this,!i.getAttribute("data-path")||this.getWrapper(i).getAttribute("data-local-search")?t.doLocalSearch(e):t.delay(function(){t.doAjaxSearch(e)},250))},t.doLocalSearch=function(e){var e=e.target,i=e.value.toUpperCase(),e=e.closest(".fpf-field-item"),t=e.querySelectorAll(this.resultsOnClickElement+" ul li:not(.no_results)"),s=(t.forEach(function(e){var t;!e.classList.contains("is-separator")&&-1<((t=e.querySelector(".title")).textContent||t.innerText).toUpperCase().indexOf(i)?e.classList.remove("is-hidden"):e.classList.add("is-hidden")}),e.querySelectorAll(this.resultsOnClickElement+" ul li:not(.no_results).is-hidden")),n=e.querySelector(this.resultsOnClickElement+" ul");t.length==s.length?n.querySelector("li.no_results")?n.querySelector("li.no_results").classList.remove("hide"):((t=document.createElement("li")).classList.add("no_results","skip"),t.innerHTML=fpf_js_object.FPF_NO_RESULTS_FOUND,n.appendChild(t)):n.querySelector("li.no_results")&&n.querySelector("li.no_results").classList.add("hide"),""===i&&(s=e.querySelectorAll(this.resultsOnClickElement+" ul li.is-separator.is-hidden"))&&s.forEach(function(e){e.classList.remove("is-hidden")})},t.doAjaxSearch=function(e){var t=this,i=e.target,s=i.value;if(this.previous_search_query!=s){this.previous_search_query=s;var n=this.getWrapper(e.target),e=n.querySelector(".nonce_hidden").value,l=i.getAttribute("data-path"),r=i.closest("ul").nextElementSibling,a="";if(this.onClickResultsExist(n)&&(a=n.querySelector(this.resultsOnClickElement)),""==s)return this.clearResultsBox(r),void((c=c||n.querySelector(this.resultsOnClickElement))&&c.classList.add("is-visible"));var o={nonce:e,path:l,search:s,hide_ids:n.getAttribute("data-hide-ids"),action:"fpf_searchdropdown_get_data",post_id:fpf_js_object.post_id,ids:this.getAssignedIDs(i)},c=(this.showLoadingIcon(n),Object.keys(o).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(o[e])}).join("&"));fetch(fpf_js_object.ajax_url+"?"+c).then(function(e){return e.json()}).then(function(e){void 0!==e.html&&""!=e.html?(t.onClickResultsExist(n)&&a.classList.remove("is-visible"),t.setResultsBox(r,e)):t.clearResultsBox(r)}).finally(function(){t.hideLoadingIcon(n)})}},t.getAssignedIDs=function(e){var t=[];return e.closest("ul").querySelectorAll("li.result-item").forEach(function(e){t.push(e.querySelector("input").value)}),t},t.handleResultsClick=function(e){this.onResultClick(e.target)},t.onResultClick=function(e){var t=e.closest(this.resultsElement);if(t&&e.closest("li")&&((e=e.closest("li")).classList.remove("selected"),!e.classList.contains("is-disabled")&&!e.classList.contains("skip"))){var i=this.getWrapper(t),s=i.querySelector(this.choicesElement),n=i.getAttribute("data-multiple")||!0;if("0"==n){s.querySelector("li.result-item")&&s.querySelector("li.result-item").remove(),this.makeAllResultsItemsAvailable(i);var l=new CustomEvent("onFPFSearchDropdownSingleValueChange",{cancelable:!0,detail:{key:e.dataset.id,container:i,element:e}});if(document.dispatchEvent(l),l.defaultPrevented)return;i.querySelector(this.dropdownToggle).classList.add("has-value"),i.querySelector(this.dropdownToggle+" .label").innerHTML=e.querySelector(".title").innerHTML}var r,a,l=e.getAttribute("data-id");l&&(this.onClickResultsExist(i)&&(r=i.querySelector(this.resultsOnClickElement),a=l.replace(/\\/g,"\\\\"),r.querySelector('li[data-id="'+a+'"]')&&(r.querySelector('li[data-id="'+a+'"]').classList.add("is-disabled"),r.querySelector('li[data-id="'+a+'"]').classList.add("skip"))),r=i.querySelector("."+this.searchItemClass).getAttribute("data-path"),a=e.innerHTML,(i=s.querySelector("li.hidden-template").cloneNode(!0)).classList.remove("hidden-template"),i.classList.add("result-item"),"0"==n&&i.classList.add("hide"),i.querySelector(".text")&&(i.querySelector(".text").innerHTML=a),(e=i.querySelector("input")).value=l,n=e.getAttribute("data-name"),e.setAttribute("name",n),e.setAttribute("class","fpf-selected-dropdown-value"),e.removeAttribute("data-name"),a=s.querySelector("li:last-child"),i.querySelector(".meta .text")&&i.querySelector(".meta .text").remove(),a.before(i),a.querySelector('input[type="text"]').value="",this.clearResultsBox(t),r||this.makeAllResultsItemsVisible(t),this.previous_search_query&&(this.previous_search_query=""),t.closest(this.wrapperElement).classList.remove("clicked"))}},t.makeAllResultsItemsAvailable=function(e){e.querySelectorAll(this.resultsElement).forEach(function(e){e=e.querySelectorAll("li.is-disabled");e&&e.forEach(function(e){e.classList.remove("is-disabled"),e.classList.remove("skip")})})},t.makeAllResultsItemsVisible=function(e){e=e.querySelectorAll("li.is-hidden");e&&e.forEach(function(e){e.classList.remove("is-hidden")})},t.handleResultItemRemoval=function(e){var t,i=e.target.closest(this.resultRemoveItem);i&&(t=i.closest("li").querySelector("input").value,this.onClickResultsExist(i.closest(".fpf-field-item"))&&(t=i.closest(".fpf-field-item").querySelector(this.resultsOnClickElement).querySelector('li[data-id="'+t+'"]'))&&(t.classList.remove("is-disabled"),t.classList.remove("skip")),i.closest("li").remove(),e.preventDefault())},t.handleRemoveSingleValue=function(e){var t,e=e.target.closest(this.removeSingleValueButton);e&&(e=e.closest(this.dropdownToggle),t=this.getWrapper(e),e.classList.remove("has-value"),(e=e.querySelector(":scope > .label")).innerHTML=e.dataset.placeholder,e=new CustomEvent("onFPFSearchDropdownSingleValueRemove",{detail:{key:t.querySelector(this.choicesElement+' li.result-item input[type="hidden"]').value,element:t}}),document.dispatchEvent(e),this.resetSingle(t))},t.resetSingle=function(e){this.clearItem(e);var t=e.querySelector(this.choicesElement),t=(t.querySelector("li.result-item")&&t.querySelector("li.result-item").remove(),e.querySelector(this.resultsOnClickElement));t&&(t.querySelectorAll("li.is-disabled").forEach(function(e){e.classList.remove("is-disabled")}),t.querySelectorAll("li.skip").forEach(function(e){e.classList.remove("skip")}))},t.handleOnClickResultsToggle=function(e){var t,i,s=e.target.closest(this.choicesElement);s&&(s=s.closest(this.wrapperElement),this.onClickResultsExist(s)&&!e.target.classList.contains(this.resultRemoveItem.substring(1))&&(this.makeAllResultsItemsVisible(s),t=s.getAttribute("data-multiple"),(i=s.querySelector(this.resultsOnClickElement+".is-visible"))&&"0"!=t&&i.classList.remove("is-visible"),(i=s.querySelector(this.resultsElement+".is-visible"))&&"0"!=t&&i.classList.remove("is-visible"),s.classList.add("clicked"),s.querySelector(this.resultsOnClickElement).classList.add("is-visible"),e.preventDefault()))},t.getTotalSelectedChoices=function(e){return e?e.querySelectorAll(".result-item").length:0},t.setResultsBox=function(e,t){e.innerHTML=JSON.parse(t.html),e.classList.add("is-visible")},t.clearResultsBox=function(e){e.classList.remove("is-visible");e=this.getWrapper(e);this.isSingle(e)&&this.dropdownChangeStatus(e.querySelector(this.dropdownToggle),"close")},t.isSingle=function(e){return"0"==e.getAttribute("data-multiple")},t.showLoadingIcon=function(e){e.querySelector(this.loadingIconClass).classList.add("is-visible")},t.hideLoadingIcon=function(e){e.querySelector(this.loadingIconClass).classList.remove("is-visible")},t.onClickResultsExist=function(e){return!!e.querySelector(this.resultsOnClickElement)},t.getWrapper=function(e){e=e.closest(this.wrapperElement);return e||!1},e}();FPF_Helper.onReady(function(){new FPF_SearchDropdown});

